<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script type="text/javascript" src="./jslib/three.js"></script>
<script type="text/javascript" src="./jslib/eventemitter2.js"></script>
<script type="text/javascript" src="./jslib/roslib.js"></script>
<script type="text/javascript" src="./jslib/ros3d.js"></script>

<script type="text/javascript">

var ros,
    viewer,
    gridClient,
    laserScan;

  /**
   * Setup all visualization elements when the page is loaded.
   */
  function init() {
    // Connect to ROS.
    ros = new ROSLIB.Ros({
      url : 'ws://192.168.50.130:9090'
    });

    // Create the main viewer.
    viewer = new ROS3D.Viewer({
      divID : 'map',
      width : 800,
      height : 600,
      antialias : false //禁用抗锯齿以提高性能
    });

    //初始化相机位置
    viewer.cameraControls.camera.position.x = -0.0000001;
    viewer.cameraControls.camera.position.y = 0;
    viewer.cameraControls.camera.position.z = 10;

    // Setup the map client.
    gridClient = new ROS3D.OccupancyGridClient({
      ros : ros,
      rootObject : viewer.scene,
      continuous : true,
    });

    laserScan = new ROS3D.LaserScan({
      ros : ros,
      rootObject : viewer.scene,
      topic : '/scan',
      tfClient : new ROSLIB.TFClient({
        ros : ros,
        fixedFrame : 'map',
        angularThres : 0.01,
        transThres : 0.01,
        rate : 10.0
      }),
      material: {
        size: 0.05,
        color: 0xff00ff
      }
    });
  }

  function bottom1() {
    viewer.cameraControls.camera.position.x = 0;
    viewer.cameraControls.camera.position.y = 0.74;
    viewer.cameraControls.camera.position.z = 5;
  }

  function bottom2() {
    viewer.cameraControls.center.x = 0;
    viewer.cameraControls.center.y = 0.74;
    viewer.cameraControls.center.z = 0;
  }

  function bottom3() {
    viewer.start();
  }
</script>
</head>

<body onload="init()">
  <h1>Simple Map Example</h1>
  <button type="button" onclick="bottom1()">button1</button>
  <button type="button" onclick="bottom2()">button2</button>
  <button type="button" onclick="bottom3()">button3</button>
  <div id="map"></div>
</body>
</html>
